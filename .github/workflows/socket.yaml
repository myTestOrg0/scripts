# Socket Security GitHub Actions Workflow
# This workflow runs Socket Security scans on every commit to any branch
# It automatically detects git repository information and handles different event types

name: socket-security-workflow
run-name: Reachability check

on:
  workflow_dispatch

# Prevent concurrent runs for the same commit
concurrency:
  group: socket-scan-${{ github.ref }}-${{ github.sha }}
  cancel-in-progress: true

jobs:
  socket-security:
    permissions:
      issues: write
      contents: read
      pull-requests: write
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v5
        with:
          python-version: "pypy3.10"
      
      - name: Install Socket CLI
        run: npm install -g socket

      - name: Install UV
        run: pip install uv

      - name: Install pyenv
        run: |
          python3.10 -m venv .venv
          source .venv/bin/activate
 
      - name: Run Socket Security Scan
        env:
          SOCKET_CLI_API_TOKEN: ${{ secrets.SOCKET_SECURITY_API_KEY }}
        run: socket scan create --reach --org "lido-labs" .
